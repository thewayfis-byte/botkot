<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>–ö–ª—é—á–∏ - Wayfis</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-logo">Wayfis</div>
    <ul class="sidebar-menu">
      <li><a href="/dashboard">üìä –î–∞—à–±–æ—Ä–¥</a></li>
      <li><a href="/keys" class="active">üîë –ö–ª—é—á–∏</a></li>
      <li><a href="/support">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</a></li>
      <li><a href="/logout">üö™ –í—ã–π—Ç–∏</a></li>
    </ul>
  </div>

  <div class="main-content">
    <div class="header">
      <h1 class="header-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏</h1>
      <div class="header-nav">
        <a href="/dashboard">–î–∞—à–±–æ—Ä–¥</a>
        <a href="/keys" class="active">–ö–ª—é—á–∏</a>
        <a href="/support">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
        <a href="/logout">–í—ã–π—Ç–∏</a>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h2 class="card-title">–í—Å–µ –∫–ª—é—á–∏</h2>
        <button onclick="document.getElementById('addModal').classList.remove('hidden')" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th>–ö–ª—é—á</th>
            <th>–¢–æ–≤–∞—Ä</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
          </tr>
        </thead>
        <tbody>
          <% keys.forEach(key => { %>
            <tr>
              <td><code><%= key.key_value %></code></td>
              <td><%= key.product_name %></td>
              <td>
                <span class="status <%= key.is_used ? 'status-error' : 'status-success' %>">
                  <%= key.is_used ? '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω' : '–î–æ—Å—Ç—É–ø–µ–Ω' %>
                </span>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
  <div id="addModal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;">
    <div class="card" style="width: 500px; max-width: 90vw;">
      <h3 class="card-title">–î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á</h3>
      <form method="POST" action="/keys">
        <div class="form-group">
          <label class="form-label">–¢–æ–≤–∞—Ä</label>
          <select name="product_id" class="form-select" required>
            <% products.forEach(p => { %>
              <option value="<%= p.id %>"><%= p.name %></option>
            <% }); %>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">–ö–ª—é—á</label>
          <input name="key_value" class="form-input" placeholder="XXXXX-XXXXX-XXXXX" required>
        </div>
        <div class="card-actions">
          <button type="button" onclick="document.getElementById('addModal').classList.add('hidden')" class="btn btn-outline">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // –°–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    document.addEventListener('click', (e) => {
      const modal = document.getElementById('addModal');
      if (e.target === modal) {
        modal.classList.add('hidden');
      }
    });
  </script>
</body>
</html>